`CMD` внутри Dockerfile определяет программу, которая будет запущена в контейнере в процессе его старта.

Почему дефолтный контейнер, например с Ubuntu, запускается и сразу завершается?

В Dockerfile Ubuntu указано `CMD ["bash"]`, но процесс bash не похож например на процесс веб-сервера или БД.

Это shell, который слушает input c терминала и, если не может найти терминал, то завершается.

То есть при запуске `docker run ubuntu` запускается bash, по умолчанию Docker не аттачит терминал к контейнеру при старте.

Bash не находит терминал и завершается сразу после старта, соответственно и контейнер также завершается.

Мы можем разово переопределить дефолтную команду при запуске контейнера - `docker run ubuntu sleep 5`.

В этом случае контейнер запускается, выполняет указанную нами команду и завершается.

Если же мы хотим переопределить команду при запуске контейнера на постоянной основе, то нам необходимо пересобрать образ:

```Dockerfile
FROM ubuntu
CMD sleep 5
```

Либо в формате JSON:

```Dockerfile
FROM ubuntu
CMD ["sleep", "5"]
```

При задании команды в формате JSON важно помнить, что первый элемент массива должен быть исполняемым файлом.

Нельзя писать `CMD ["sleep 5"]`, команда и ее параметр должны быть отдельными элементами массива.

Если мы соберем новый образ из Dockerfile выше `docker build -t ubuntu-sleeper .`, то при запуске `docker run ubuntu-sleeper`, контейнер будет выполнять команду `sleep 5` и завершаться.

Если мы захотим переопределить значение `sleep` на `10`, нужно будет запускать `docker run ubuntu-sleeper sleep 10`, что не очень красиво.

Чтобы мы могли запускать контейнер командой `docker run ubuntu-sleeper 10`, нам нужно использовать инструкцию `ENTRYPOINT`.

```Dockerfile
FROM ubuntu
ENTRYPOINT ["sleep"]
```

Инструкция `ENTRYPOINT` очень похожа на `CMD`, но при запуске контейнера `docker run ubuntu-sleeper 10`, значение `10` будет **добавлено** к команде `sleep`.

Если мы запустим контейнер `docker run ubuntu-sleeper` без указания параметра, то получим ошибку `sleep: missing operand`.

Чтобы задать некое дефолтное значение для `sleep`, мы можем объединить `ENTRYPOINT` и `CMD`:

```Dockerfile
FROM ubuntu
ENTRYPOINT ["sleep"]
CMD ["5"]
```

То есть при запуске контейнера без параметров, он запустится с командой `sleep 5`, если мы укажем `docker run ubuntu-sleeper 10`, то новое значение переопределит значение из `CMD`.

Важно! При комбинации `ENTRYPOINT` и `CMD`, необходимо использовать JSON-формат.

Если нам нужно переопределить дефолтную команду `sleep` из инструкции `ENTRYPOINT` на некую вымышленную (для примера) команду `sleep2.0`:

```shell
docker run --entrypoint sleep2.0 ubuntu-sleeper 10
```

If you list more than one `CMD` instruction in the Dockerfile then only the last `CMD` will take effect.